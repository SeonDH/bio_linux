# 22. 도커(Docker)

## 개요

* Docker는 애플리케이션을 컨테이너라는 격리된 환경에서 실행할 수 있도록 해주는 플랫폼
* 애플리케이션과 종속성을 패키징하여 일관된 실행 환경 제공
* 개발, 테스트, 배포, 운영 환경 간 일관성 유지에 도움

---

## 주요 개념

### 1. 이미지 (Image)

* 컨테이너 생성용 읽기 전용 템플릿
* 애플리케이션 코드, 라이브러리, 종속성 포함
* 계층 구조로 구성됨
* 베이스 이미지 (ex. `ubuntu`, `alpine`) 또는 커스텀 이미지 존재

### 2. 컨테이너 (Container)

* 이미지를 실행한 인스턴스
* 각 컨테이너는 격리된 파일 시스템과 자원 사용
* 상태: 시작, 중지, 재시작, 일시 정지 등 가능
* 변경사항은 기본 이미지에 반영되지 않음 → 변경하려면 새로운 이미지 생성 필요

### 3. Dockerfile

* 이미지 빌드를 위한 명령어 모음
* 주요 명령어: `FROM`, `COPY`, `RUN`, `CMD`, `EXPOSE`, `WORKDIR`, `ENV`
* 단계별 캐시 가능 → 빌드 속도 향상

---

## Docker의 주요 기능

| 기능         | 설명                 |
| ---------- | ------------------ |
| 애플리케이션 격리  | 서로 다른 앱 간 충돌 방지    |
| 효율적인 자원 사용 | VM 대비 경량, 빠른 시작    |
| 이식성        | 한번 빌드 → 어디서나 실행 가능 |
| 빠른 배포      | 빠른 실행, 손쉬운 배포      |

---

## Docker 기본 명령어

| 작업           | 명령어                              |
| ------------ | -------------------------------- |
| 이미지 빌드       | `docker build -t myapp .`        |
| 컨테이너 실행      | `docker run -d -p 8080:80 myapp` |
| 실행 중 컨테이너 확인 | `docker ps`                      |
| 컨테이너 정지      | `docker stop <container>`        |
| 컨테이너 시작      | `docker start <container>`       |
| 로그 확인        | `docker logs <container>`        |

---

## Docker 설치 (Ubuntu 기준)

```bash
sudo apt-get update
sudo apt-get install -y docker.io
sudo systemctl start docker
sudo systemctl enable docker
```

---

## Dockerfile 빌드 예제

### 1. 파일 구성

* `echo_docker.sh`

```bash
#!/bin/bash
echo "Hello, Docker!"
```

* `Dockerfile`

```Dockerfile
FROM alpine:latest
RUN apk add --no-cache bash
WORKDIR /app
COPY echo_docker.sh .
RUN chmod +x echo_docker.sh
CMD ["bash", "./echo_docker.sh"]
```

### 2. 빌드 및 실행

```bash
sudo docker build -t my-echo-app .
sudo docker run --rm my-echo-app
```

### 3. 이미지 확인 및 삭제

```bash
sudo docker images
sudo docker rmi <image_id>
```

---

## 도커와 프로세스 비교

| 항목           | 설명                                 |
| ------------ | ---------------------------------- |
| 컨테이너         | 실제로는 하나 이상의 격리된 프로세스를 실행함          |
| 이미지          | 실행 가능한 설정/파일 집합 → 스크립트와 유사         |
| `docker run` | CMD 또는 ENTRYPOINT 실행 → 스크립트 실행과 유사 |

---

## \[실습] Docker 이미지 생성 및 실행

1. `docker.io` 설치
2. `echo_docker.sh`, `Dockerfile` 작성
3. `docker build`로 이미지 생성
4. `docker run`으로 컨테이너 실행
5. 로그 또는 출력 결과 확인
6. `docker ps`, `docker stop`, `docker rmi` 활용

## 도커 주의 사항 (용량)

https://csj000714.tistory.com/603